# Log rotation configuration for Garment Platform
# Place this file in /etc/logrotate.d/garment-platform

/opt/garment-platform/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 ec2-user ec2-user
    
    postrotate
        # Restart PM2 to refresh log file handles
        /usr/bin/pm2 reloadLogs >/dev/null 2>&1 || true
    endscript
}

/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    
    postrotate
        # Reload nginx to refresh log file handles
        /bin/systemctl reload nginx >/dev/null 2>&1 || true
    endscript
}

/var/log/mysqld.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 mysql mysql
    
    postrotate
        # Flush MySQL logs
        /usr/bin/mysqladmin -u root -pGarmentPlatform2024! flush-logs >/dev/null 2>&1 || true
    endscript
}

/opt/garment-platform/logs/system-monitor.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 644 ec2-user ec2-user
}